<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>سيارات إم جي الكويت | أحمد — مندوب مبيعات في مجموعة الغانم</title>
  <meta name="description" content="موقع شخصي لأحمد — مندوب مبيعات في مجموعة الغانم لسيارات إم جي في الكويت. تصفّح أحدث الموديلات، استعلم على واتساب، واحسب التمويل خطوة بخطوة." />
  <meta name="theme-color" content="#25D366" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- AOS Animation Library -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <style>
    :root {
      --wa: #16a34a;
      --primary: #374151;
      --primary-light: #6b7280;
      --primary-dark: #1f2937;
      --secondary: #64748b;
      --accent: #059669;
      --dark: #0f172a;
      --muted: #64748b;
      --gradient-start: #374151;
      --gradient-end: #1f2937;
      --card-bg: #ffffff;
      --border-light: #e5e7eb;
    }
    * { transition: all .25s ease; }
    @media (prefers-reduced-motion: reduce) { * { transition: none !important; animation: none !important; } }
    
    /* Mobile UX Optimizations */
    @media (max-width: 768px) {
      html, body {
        scroll-behavior: smooth;
        overscroll-behavior-y: contain;
        -webkit-overflow-scrolling: touch;
      }
      
      /* Improved touch targets */
      .btn, .nav-link, button, select, input[type="submit"] {
        min-height: 44px;
        min-width: 44px;
        padding: 10px 15px;
        font-size: 16px;
      }
      
      /* Prevent zoom on iOS */
      input, select, textarea {
        font-size: 16px !important;
      }
      
      /* Better spacing */
      section {
        padding: 40px 0;
      }
      .container {
        padding-left: 20px;
        padding-right: 20px;
      }
      
      /* Add space at bottom for fixed nav */
      body {
        padding-bottom: 70px;
      }
    }

    body { 
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
      background: #ffffff;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: manipulation;
    }
    .btn-wa { 
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); 
      border: none; 
      color: #fff;
      box-shadow: 0 4px 15px rgba(22, 163, 74, 0.3);
      min-height: 48px;
      font-size: 1.1rem;
      font-weight: 600;
    }
    .btn-wa:hover { 
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(22, 163, 74, 0.4);
    }
    .btn-primary { 
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); 
      border: none;
      box-shadow: 0 4px 15px rgba(55, 65, 81, 0.3);
      min-height: 48px;
      font-size: 1.1rem;
      font-weight: 600;
    }
    .btn-primary:hover { 
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(55, 65, 81, 0.4);
    }

    .hero {
      position: relative; min-height: 85vh; display: grid; place-items: center;
      color: #fff; text-align: center; overflow: hidden; 
      background: #1f2937;
    }
    @media (max-width: 768px) {
      .hero { min-height: 75vh; padding: 2rem 0; }
      .hero h1 { font-size: 1.8rem !important; line-height: 1.3; margin-bottom: 1rem !important; }
      .hero .lead { font-size: 1rem !important; margin-bottom: 2rem !important; }
    }
    .hero-video {
      position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1;
    }
    .hero::before { 
      content:""; position:absolute; inset:0; z-index: 2;
      background: radial-gradient(circle at 30% 70%, rgba(0,0,0,0.3) 0%, transparent 50%),
                  radial-gradient(circle at 70% 30%, rgba(0,0,0,0.2) 0%, transparent 50%);
    }
    .hero::after { 
      content:""; position:absolute; inset:0; z-index: 3;
      background: linear-gradient(135deg, rgba(31, 41, 55, 0.7) 0%, rgba(17, 24, 39, 0.6) 100%);
    }
    .hero > .content { position: relative; z-index: 4; }
    .hero h1 { font-weight: 800; letter-spacing: -0.02em; }

    .navbar {
      background: rgba(255, 255, 255, 0.95) !important;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-light);
    }
    .navbar-brand {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--accent) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      font-weight: 800;
    }
    .section-title { 
      font-weight: 800; letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .shadow-soft { 
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08), 0 10px 20px rgba(0, 0, 0, 0.05); 
    }

    /* Car cards */
    .car-card { 
      border: none; border-radius: 1rem; overflow: hidden; 
      background: #ffffff;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      transition: transform .3s ease, box-shadow .3s ease;
      border: 1px solid #f1f5f9;
      margin-bottom: 1.5rem;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    }
    .car-card:hover { transform: translateY(-4px); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12); }
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .car-card { margin-bottom: 1rem; border-radius: 0.75rem; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
      .car-card:hover { transform: translateY(-2px); }
      .car-card:active { transform: scale(0.98); transition: transform 0.1s ease; }
      
      /* Improved touch targets */
      .btn, .nav-link, select, input[type="radio"], input[type="checkbox"] {
        min-height: 44px;
        min-width: 44px;
      }
      
      /* Better spacing for mobile */
      .container {
        padding-left: 1.25rem;
        padding-right: 1.25rem;
      }
      
      /* Improved scrolling */
      html, body {
        scroll-behavior: smooth;
        overscroll-behavior-y: contain;
      }
      
      /* Prevent zoom on form fields */
      input, select, textarea {
        font-size: 16px !important;
      }
    }
    .car-card .img-wrap{ position: relative; width: 100%; aspect-ratio: 16 / 9; overflow: hidden; background: #f3f4f6; }
    .car-card .img-wrap img{ width: 100%; height: 100%; object-fit: cover; display: block; transition: transform .4s ease; background: #f8f9fa; }
    .car-card:hover .img-wrap img{ transform: scale(1.04); }

    .price-badge{
      position: absolute; right: 1rem; bottom: 1rem;
      background: linear-gradient(135deg, rgba(31, 41, 55, 0.9) 0%, rgba(17, 24, 39, 0.9) 100%); 
      color: #fff; padding: .5rem .8rem;
      border-radius: .75rem; font-weight: 700; font-size: 1rem; 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    @media (max-width: 768px) {
      .price-badge { font-size: 0.9rem; padding: 0.4rem 0.7rem; right: 0.75rem; bottom: 0.75rem; }
    }

    .car-quick-features { list-style: none; padding: 0; margin: .25rem 0 1rem 0; color: var(--muted); font-size: .95rem; }
    .car-quick-features li { display: inline-flex; align-items: center; gap: .4rem; margin-inline-end: .75rem; }

    /* Floating WA */
    .fab-wa {
      position: fixed; right: 20px; bottom: 80px; z-index: 1100;
      display: inline-flex; align-items: center; justify-content: center;
      width: 60px; height: 60px; border-radius: 999px; color: #fff;
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
      box-shadow: 0 15px 35px rgba(22, 163, 74, 0.3), 0 8px 15px rgba(0, 0, 0, 0.1);
      transition: all .3s ease; text-decoration: none;
    }
    .fab-wa:hover { transform: translateY(-4px) scale(1.05); color: #fff; }
    .fab-wa svg { width: 28px; height: 28px; }
    @media (max-width: 768px) { .fab-wa { width: 56px; height: 56px; right: 16px; bottom: 96px; } .fab-wa svg { width: 26px; height: 26px; } }
    
    /* Bottom nav */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      display: flex; justify-content: space-around; align-items: center;
      background: #fff; border-top: 1px solid #e5e7eb; padding: .5rem 0; z-index: 1200;
    }
    .bottom-nav a { flex: 1; text-align: center; color: var(--primary); font-size: .9rem; text-decoration: none; }
    .bottom-nav a .icon { display:block; font-size: 1.1rem; margin-bottom: .15rem; }
    @media (min-width: 768px) { .bottom-nav { display: none; } }

    /* Dark Mode */
    body.dark-mode {
      background: #0f172a;
      color: #e5e7eb;
    }
    body.dark-mode .navbar {
      background: rgba(17, 24, 39, 0.9) !important;
      border-color: #1f2937;
    }
    body.dark-mode .car-card,
    body.dark-mode .card,
    body.dark-mode .modal-content {
      background: #111827;
      color: #e5e7eb;
      border-color: #1f2937;
    }
    body.dark-mode .car-card .img-wrap {
      background: #0b1220;
    }
    body.dark-mode .bottom-nav {
      background: #0b1220;
      border-color: #1f2937;
    }
    body.dark-mode .price-badge {
      background: linear-gradient(135deg, rgba(0,0,0,.85), rgba(0,0,0,.7));
    }
    
    /* Dark mode toggle button */
    .dark-mode-toggle {
      position: fixed;
      left: 20px;
      bottom: 80px;
      z-index: 1100;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      border-radius: 999px;
      color: #fff;
      background: linear-gradient(135deg, #4b5563 0%, #1f2937 100%);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      border: none;
      transition: all .3s ease;
    }
    .dark-mode-toggle:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    body.dark-mode .dark-mode-toggle {
      background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
    }
    @media (max-width: 768px) {
      .dark-mode-toggle {
        width: 46px;
        height: 46px;
        left: 16px;
        bottom: 96px;
      }
    }

    /* Wizard */
    .wizard-steps { display:flex; gap:.5rem; margin-bottom: .75rem; }
    .wizard-steps .step { flex:1; height:6px; border-radius:999px; background:#e5e7eb; }
    .wizard-steps .step.active { background: #16a34a; }
    .wizard-pane { display:none; }
    .wizard-pane.active { display:block; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">MG Kuwait | Ahmed (Sales)</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="#cars">السيارات</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">تواصل</a></li>
        </ul>
        <a id="ctaWhatsAppTop" class="btn btn-wa ms-lg-3 text-white fw-semibold" target="_blank" rel="noopener">تواصل واتساب</a>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header id="hero" class="hero">
    <video class="hero-video" autoplay muted loop playsinline>
      <source src="mg video.mp4" type="video/mp4">
      <source src="mg video.webm" type="video/webm">
      Your browser does not support the video tag.
    </video>
    <div class="content container py-5">
      <div class="mx-auto" style="max-width: 880px;" data-aos="fade-up">
        <span class="badge bg-light text-dark mb-2 px-3 py-2 rounded-pill" data-aos="fade-down" data-aos-delay="200">تنويه: موقع شخصي لمندوب مبيعات</span>
        <h1 class="display-5 mb-2" data-aos="fade-up" data-aos-delay="300">سيارات إم جي في الكويت — <span class="text-success">أحمد</span> مندوب مبيعات في مجموعة الغانم</h1>
        <p class="lead mb-3" data-aos="fade-up" data-aos-delay="400">أساعدك تختار أنسب سيارة إم جي 2025 وتكمّل طلبك بسهولة على واتساب. <strong>لست الوكيل الرسمي</strong>، أنا مندوب مبيعات يعمل لدى مجموعة الغانم في الكويت.</p>
        <div class="d-flex gap-3 justify-content-center flex-wrap mb-3" data-aos="fade-up" data-aos-delay="500">
          <a id="ctaWhatsAppHero" class="btn btn-lg btn-wa text-white fw-semibold px-4" target="_blank" rel="noopener">تواصل الآن على واتساب</a>
          <a href="#cars" class="btn btn-outline-light btn-lg fw-semibold px-4">تصفّح السيارات</a>
        </div>
        <ul class="list-unstyled d-flex gap-4 mt-3 justify-content-center list-hero" data-aos="fade-up" data-aos-delay="600">
          <li>✔ عروض وتمويل بالتعاون مع شركات محلية</li>
          <li>✔ متابعة شخصية حتى استلام السيارة</li>
          <li>✔ دعم ما بعد البيع عبر قنوات المجموعة</li>
        </ul>
      </div>
    </div>
  </header>

  <!-- Cars -->
  <section id="cars" class="py-5" style="background: #ffffff;">
    <div class="container">
      <div class="d-flex align-items-end justify-content-between flex-wrap gap-3 mb-4">
        <div data-aos="fade-right">
          <h2 class="section-title mb-1">أحدث سيارات إم جي الجديدة 2025 في الكويت</h2>
          <p class="text-secondary mb-0">اختر سيارتك واضغط <strong>اشترِ الآن</strong> لملء بيانات بسيطة ثم نكمل على واتساب.</p>
        </div>
        <div class="d-flex gap-2 flex-wrap align-items-center" data-aos="fade-left">
          <input id="searchInput" type="search" class="form-control" placeholder="ابحث بالاسم..." style="max-width: 200px; min-width: 150px;">
          <select id="filterSelect" class="form-select" style="max-width: 160px; min-width: 140px;">
            <option value="all">كل الموديلات</option>
            <option value="new">موديلات جديدة</option>
            <option value="premium">فئة فاخرة</option>
            <option value="electric">سيارات كهربائية</option>
          </select>
        </div>
      </div>

      <div id="carsGrid" class="row g-3"></div>
    </div>
  </section>

  <!-- Floating WhatsApp Button -->
  <a id="fabWhatsApp" class="fab-wa" target="_blank" rel="noopener" aria-label="دردشة واتساب">
    <svg viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M19.11 17.19c-.3-.15-1.76-.86-2.03-.96-.27-.1-.47-.15-.67.15-.2.3-.77.96-.95 1.16-.17.2-.35.22-.65.07-.3-.15-1.28-.47-2.44-1.5-.9-.8-1.5-1.78-1.67-2.08-.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.02-.52-.08-.15-.67-1.6-.92-2.2-.24-.58-.49-.5-.67-.5-.17 0-.37-.02-.57-.02-.2 0-.52.07-.8.37-.27.3-1.04 1-1.04 2.44 0 1.44 1.07 2.83 1.22 3.02.15.2 2.1 3.2 5.08 4.48.71.31 1.27.49 1.7.63.71.23 1.36.2 1.88.12.57-.09 1.76-.72 2-1.42.25-.7.25-1.3.17-1.42-.07-.12-.27-.2-.57-.35z"/><path d="M26.87 5.14A12.8 12.8 0 0 0 16 1.33C8.6 1.33 2.6 7.33 2.6 14.74c0 2.34.61 4.64 1.76 6.66L2 30.67l9.45-2.27a13.35 13.35 0 0 0 4.55.78c7.4 0 13.4-6 13.4-13.4 0-3.58-1.39-6.95-3.94-9.43zM16 27.33c-1.38 0-2.75-.26-4.03-.77l-.86-.36-5.6 1.35 1.35-5.36-.38-.88a10.8 10.8 0 0 1-1.16-4.57c0-5.97 4.86-10.8 10.8-10.8 2.88 0 5.58 1.13 7.62 3.17a10.7 10.7 0 0 1 3.17 7.63c0 5.97-4.86 10.8-10.8 10.8z"/></svg>
  </a>
  
  <!-- Dark Mode Toggle Button -->
  <button id="darkModeToggle" class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="تبديل الوضع المظلم">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
      <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    </svg>
  </button>

  <!-- Contact -->
  <section id="contact" class="py-5" style="background: #ffffff;">
    <div class="container">
      <div class="row g-4 align-items-center">
        <div class="col-lg-6" data-aos="fade-right">
          <div class="d-flex align-items-center gap-3 mb-3">
            <img id="contactPhoto" class="contact-photo shadow-soft" alt="صورة أحمد" src="https://images.unsplash.com/photo-1531123414780-f742b7a5e0a8?q=80&w=600&auto=format&fit=crop" loading="lazy" style="width:112px;height:112px;object-fit:cover;border-radius:999px;border:4px solid #fff;">
            <div>
              <h3 class="mb-1" id="salesName">Ahmed — مندوب مبيعات MG</h3>
              <div class="text-secondary">أعمل في مجموعة الغانم | هذا موقع شخصي للتواصل مع العملاء</div>
            </div>
          </div>
          <p class="text-muted">أنا أحمد، أساعدك تختار سيارة إم جي الأنسب لك، أوفق لك العروض والتمويل المتاح عبر شركاء محليين، وأتابع معك حتى استلام السيارة. **لست الوكيل الرسمي** — هذا الموقع شخصي لتسهيل التواصل والطلبات.</p>
          <div class="d-flex gap-2 flex-wrap">
            <a id="ctaWhatsAppContact" class="btn btn-wa text-white fw-semibold" target="_blank" rel="noopener">واتساب</a>
            <a id="ctaCall" class="btn btn-outline-success fw-semibold" target="_blank" rel="noopener">اتصال</a>
            <a id="ctaEmail" class="btn btn-outline-secondary fw-semibold" target="_blank" rel="noopener">إيميل</a>
          </div>
        </div>
        <div class="col-lg-6" data-aos="fade-left" data-aos-delay="200">
          <iframe id="mapEmbed" class="map-embed shadow-soft" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade" src="https://maps.google.com/maps?q=Kuwait%20City&t=&z=12&ie=UTF8&iwloc=&output=embed" style="border:0;width:100%;height:260px;border-radius:1rem;"></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- Purchase Modal (with Finance Wizard) -->
  <div class="modal fade" id="purchaseModal" tabindex="-1" aria-labelledby="purchaseLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="purchaseLabel">طلب شراء / تمويل</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
        </div>
        <div class="modal-body">
          <form id="purchaseForm" class="needs-validation" novalidate>
            <div class="mb-2">
              <label for="carName" class="form-label">السيارة</label>
              <input type="text" id="carName" class="form-control" readonly>
            </div>

            <!-- Wizard steps -->
            <div class="wizard-steps mb-3">
              <div class="step step-1 active"></div>
              <div class="step step-2"></div>
              <div class="step step-3"></div>
            </div>

            <!-- Pane 1: basic info + payment type -->
            <div class="wizard-pane active" data-pane="1">
              <div class="row g-3">
                <div class="col-sm-6">
                  <label for="custName" class="form-label">اسمك</label>
                  <input type="text" id="custName" class="form-control" placeholder="أحمد علي" required>
                  <div class="invalid-feedback">فضلاً اكتب اسمك.</div>
                </div>
                <div class="col-sm-6">
                  <label for="custPhone" class="form-label">رقمك</label>
                  <input type="tel" id="custPhone" class="form-control" placeholder="+965 9690 2117" pattern="^[0-9+()\\-\\s]{7,}$" required>
                  <div class="form-text">إذا كنت خارج الكويت ضِف كود الدولة.</div>
                  <div class="invalid-feedback">فضلاً اكتب رقم صحيح.</div>
                </div>
              </div>

              <div class="mt-3">
                <label class="form-label">طريقة الدفع</label>
                <div class="d-flex gap-3">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="payCash" value="Cash" checked>
                    <label class="form-check-label" for="payCash">كاش</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="paymentMethod" id="payFinance" value="Finance">
                    <label class="form-check-label" for="payFinance">تمويل</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pane 2: finance options (shown if Finance) -->
            <div class="wizard-pane" data-pane="2">
              <div class="alert alert-info py-2 mb-3">اختر شركة التمويل والمدة والدفعة الأولى — سنحسب لك القسط فورًا.</div>
              <div class="row g-3">
                <div class="col-sm-6">
                  <label for="bankSelect" class="form-label">شركة التمويل</label>
                  <select id="bankSelect" class="form-select">
                    <option value="" selected disabled>اختر شركة تمويل…</option>
                  </select>
                  <div class="invalid-feedback">فضلاً اختر شركة تمويل.</div>
                </div>
                <div class="col-sm-3">
                  <label for="loanYears" class="form-label">سنوات</label>
                  <select id="loanYears" class="form-select">
                    <option value="" selected disabled>—</option>
                  </select>
                  <div class="invalid-feedback">فضلاً اختر السنوات.</div>
                </div>
                <div class="col-sm-3">
                  <label for="apr" class="form-label">نسبة الفائدة %</label>
                  <input type="number" id="apr" class="form-control" value="" min="0" step="0.1" readonly style="background-color: #f8f9fa;" placeholder="تحدد حسب الشركة">
                </div>
              </div>
              <div class="row g-3 mt-1">
                <div class="col-sm-4">
                  <label for="downPayment" class="form-label">الدفعة الأولى (د.ك)</label>
                  <input type="number" id="downPayment" class="form-control" value="0" min="0" step="100">
                </div>
                <div class="col-sm-4">
                  <label for="budget" class="form-label">القسط المناسب شهريًا (د.ك)</label>
                  <input type="number" id="budget" class="form-control" min="0" step="10">
                </div>
                <div class="col-sm-4">
                  <label class="form-label">القسط التقديري</label>
                  <input type="text" id="emi" class="form-control" readonly>
                </div>
              </div>
            </div>

            <!-- Pane 3: result & summary -->
            <div class="wizard-pane" data-pane="3">
              <div class="row g-3">
                <div class="col-sm-6">
                  <label class="form-label">الإجمالي المستحق</label>
                  <input type="text" id="totalPayable" class="form-control" readonly>
                </div>
                <div class="col-sm-6">
                  <label class="form-label">إجمالي الأرباح/الفوائد</label>
                  <input type="text" id="totalInterest" class="form-control" readonly>
                </div>
                <div class="col-12">
                  <label class="form-label">حالة الميزانية</label>
                  <div id="budgetStatus" class="form-control" style="height:auto; min-height: 38px; display:flex; align-items:center;">—</div>
                </div>
              </div>
              <div class="small text-muted mt-2">الأرقام تقديرية وقد تختلف حسب موافقة شركة التمويل.</div>
            </div>

            <!-- Wizard controls -->
            <div class="d-flex justify-content-between align-items-center mt-4">
              <button type="button" class="btn btn-outline-secondary" id="wizardPrev">رجوع</button>
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-primary" id="wizardNext">التالي</button>
                <button class="btn btn-wa text-white fw-semibold d-none" id="wizardSubmit" type="submit">إرسال على واتساب</button>
              </div>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Car Details Modal -->
  <div class="modal fade" id="carDetailsModal" tabindex="-1" aria-labelledby="carDetailsLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-fullscreen-md-down">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="carDetailsLabel">تفاصيل السيارة</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-0">
          <div id="carImageCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner" id="carouselImages"></div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carImageCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carImageCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
            <div class="carousel-indicators" id="carouselIndicators"></div>
          </div>
          
          <div class="p-4">
            <div class="row">
              <div class="col-lg-8">
                <h3 id="modalCarName" class="mb-3"></h3>
                <div id="modalCarBadge" class="mb-3"></div>
                
                <h5 class="text-success mb-3">المواصفات والمزايا</h5>
                <div id="carFeatures" class="mb-4"></div>
                
                <h5 class="text-success mb-3">الضمان والخدمات</h5>
                <div class="warranty-info mb-4">
                  <div class="row g-3">
                    <div class="col-md-6"><div class="d-flex align-items-center p-3 bg-light rounded"><i class="text-success me-2" style="font-size: 1.5rem;">✓</i><div><strong>حتى 5 سنوات</strong><br><small class="text-muted">حسب سياسة الجهة المقدِّمة</small></div></div></div>
                    <div class="col-md-6"><div class="d-flex align-items-center p-3 bg-light rounded"><i class="text-success me-2" style="font-size: 1.5rem;">✓</i><div><strong>مساعدة على الطريق</strong><br><small class="text-muted">تفاصيل تُحدد عند العقد</small></div></div></div>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-4">
                <div class="sticky-top">
                  <div class="card border-success">
                    <div class="card-body text-center">
                      <h4 class="text-success mb-3" id="modalCarPrice"></h4>
                      <p class="text-muted mb-3">السعر تقريبي ويُحدَّد النهائي عند كتابة العقد</p>
                      <div class="d-grid gap-2">
                        <button class="btn btn-success btn-lg" id="modalBuyBtn">🚗 اشترِ الآن</button>
                        <button class="btn btn-wa text-white" id="modalWhatsAppBtn">📱 واتساب</button>
                        <button class="btn btn-outline-primary" id="modalBrochureBtn">📋 تحميل البروشور</button>
                      </div>
                      <div class="mt-3 pt-3 border-top">
                        <small class="text-muted">تنويه: الموقع شخصي لمندوب مبيعات — ليس موقعًا رسميًا</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div><!-- col -->
            </div><!-- row -->
          </div><!-- p-4 -->
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1080">
    <div id="toast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">تم تجهيز طلبك ✅ اضغط <strong>إرسال</strong> في واتساب. برجع لك بأسرع وقت.</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <a href="#hero"><span class="icon">🏠</span>الرئيسية</a>
    <a href="#cars"><span class="icon">🚘</span>السيارات</a>
    <a id="bottomWA" href="#" target="_blank" rel="noopener"><span class="icon">💬</span>واتساب</a>
    <a href="#contact"><span class="icon">📞</span>تواصل</a>
  </nav>

  <footer class="py-4 border-top" style="background: #ffffff;">
    <div class="container small text-center text-muted">
      © <span id="year"></span> — أحمد (مندوب مبيعات MG في مجموعة الغانم). <strong>تنويه:</strong> هذا موقع شخصي للتواصل مع العملاء وليس موقعًا رسميًا للشركة.
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    // ====== CONFIG ======
    const CONFIG = {
      salesName: "Ahmed",
      whatsappNumberE164: "96596902117",
      callNumber: "+965 9690 2117",
      email: "aradwan@alghanimsons.com",
      contactPhoto: "YOUR_REAL_PHOTO_URL_HERE",
      mapEmbedSrc: "https://maps.google.com/maps?q=Alghanim+Motors+Kuwait&t=&z=13&ie=UTF8&iwloc=&output=embed",
      currencyLocale: "en-KW",
      currency: "KWD",
      themeRotateSeconds: 15,
      themes: [
        { wa: '#16a34a', primary: '#374151', dark: '#0f172a' },
        { wa: '#15803d', primary: '#4b5563', dark: '#0f172a' },
        { wa: '#059669', primary: '#6b7280', dark: '#0f172a' },
        { wa: '#047857', primary: '#1f2937', dark: '#0f172a' }
      ]
    };

    const FINANCING_COMPANIES = [
      { name: "شركة التسهيلات التجارية", rate: 6.5 },
      { name: "شركة تسهيلات الساير", rate: 8.5 },
      { name: "شركة المنار للإيجارة", rate: 7.0 }
    ];

    // ==== CARS (كما كان) ====
    const CARS = [
      { id: "mgrx9_2025", name: "MG RX9 2025", price: 3499, condition: "new", category: "premium", image: "images/mg-rx9/mg-rx9.avif", imageFolder: "images/mg-rx9/", images: ["mg-rx9.avif","mg-rx92.avif","mg-rx93.avif","mg-rx94.avif","mg_rx9.avif","mg_rx9_37.avif"], features: ["محرك 2.0 تيربو قوي","نظام دفع رباعي AWD","فتحة سقف بانورامية","نظام ملاحة ذكي","مقاعد جلدية فاخرة","نظام صوتي متطور"], description: "SUV فاخرة مجهزة بتقنيات متطورة.", brochure: "broushors/mg_rx9_brochure_en_v6.pdf" },
      { id: "mg5_2025", name: "MG 5 2025", price: 3599, condition: "new", category: "new", image: "images/mg-5/mg-5.avif", imageFolder: "images/mg-5/", images: ["mg-5.avif","mg-52.avif","mg-53.avif","mg-54.avif","mg-55.avif"], features: ["محرك 1.5 لتر اقتصادي","ناقل حركة CVT","شاشة لمس 10 بوصة","نظام أمان متقدم","مقاعد مريحة","نظام تكييف ذكي"], description: "سيدان عصرية واقتصادية.", brochure: "broushors/mg_5_brochure_en_v03_lowres_1_.pdf" },
      { id: "mg4_electric_2025", name: "MG 4 Electric 2025", price: 8900, condition: "new", category: "electric", image: "images/mg-4/mg-4.avif", imageFolder: "images/mg-4/", images: ["mg-4.avif","mg-42.avif","mg-43.avif","mg-44.avif","mg-45.avif","mg-ev.avif"], features: ["محرك كهربائي قوي","مدى 450 كم","شحن سريع DC","أنظمة ذكية","صديق للبيئة","تقنية متطورة"], description: "كهربائية بالكامل بمدى طويل.", brochure: "broushors/mg_4_brochure_eng_v6.pdf" },
      { id: "mg7_2025", name: "MG 7 1.5 Turbo 2025", price: 6399, condition: "new", category: "premium", image: "images/mg-7/mg-7.avif", imageFolder: "images/mg-7/", images: ["mg-7.avif","mg-72.avif","mg-73.avif","mg-74.avif","mg-75.avif","mg-76.avif","mg76.avif"], features: ["محرك 1.5 تيربو","قوة 170 حصان","ناقل حركة CVT","مقاعد جلدية","شاشة 12.3 بوصة","نظام صوتي","فتحة سقف"], description: "سيدان فاخرة بأداء اقتصادي.", brochure: "broushors/mg_7_brochure.pdf" },
      { id: "mg7_turbo_2025", name: "MG 7 2.0 Turbo 2025", price: 7299, condition: "new", category: "premium", image: "mg-7 2.0 turbo.webp", imageFolder: "images/mg-7/", images: ["mg-7 2.0 turbo.webp","mg-72.avif","mg-7.avif","mg-73.avif","mg-74.avif","mg-75.avif","mg-76.avif","mg76.avif"], features: ["محرك 2.0 تيربو","245 حصان","نظام دفع رباعي","مقاعد رياضية","شاشة 12.3 بوصة","نظام قيادة رياضي","سقف بانورامي","نظام صوتي BOSE"], description: "نسخة عالية الأداء.", brochure: "broushors/mg_7_brochure.pdf" },
      { id: "mg3_2025", name: "MG 3 2025", price: 3499, condition: "new", category: "new", image: "images/mg-3/mg-33.avif", imageFolder: "images/mg-3/", images: ["mg-33.avif","mg-35.avif","mg_32.avif","02.avif"], features: ["محرك 1.5 لتر","ناقل يدوي","تصميم عصري","أمان أساسي","اقتصادية","مثالية للمدينة"], description: "مدمجة عملية." },
      { id: "mg_whale_2025", name: "MG Whale 2025", price: 7777, condition: "new", category: "premium", image: "images/mg-rx9/mg_rx9.avif", imageFolder: "images/mg-rx9/", images: ["mg_rx9.avif","mg-rx9.avif","mg-rx92.avif","mg-rx93.avif"], features: ["هجين قوي","SUV فاخرة","7 راكب","نظام معلومات متطور","سقف بانورامي","قيادة ذكية"], description: "SUV كبيرة للعائلة." },
      { id: "mg_one_2025", name: "MG One 2025", price: 6666, condition: "new", category: "new", image: "images/mg-one/mg-one.avif", imageFolder: "images/mg-one/", images: ["mg-one.avif","mg-one2.avif","mg-one3.avif","mg-one4.avif","mg-one5.avif"], features: ["محرك 1.5 تيربو","دفع أمامي","شاشة ذكية","أمان متقدم","مقاعد مريحة","تصميم عصري"], description: "SUV مدمجة عملية.", brochure: "broushors/mg_one_brochure_english.pdf" },
      { id: "mg_rx5_2025", name: "MG RX5 2025", price: 5999, condition: "new", category: "new", image: "images/mg-rx5/mg-rx5.avif", imageFolder: "images/mg-rx5/", images: ["mg-rx5.avif","mg-rx52.avif","mg-rx53.avif"], features: ["محرك 1.5 تيربو","دفع رباعي","شاشة 10.1","ملاحة","مقاعد مريحة","مساعد قيادة"], description: "SUV بتقنيات ذكية.", brochure: "broushors/mg_rx5_brochure_eng_regional_smme.pdf" },
      { id: "mg_gt_2025", name: "MG GT 2025", price: 5499, condition: "new", category: "premium", image: "images/mg-gt/mg-gt.avif", imageFolder: "images/mg-gt/", images: ["mg-gt.avif","mg-gt2.avif","mg-gt3.avif"], features: ["محرك V6","دفع خلفي","مقاعد رياضية","تعليق رياضي","شاشة متطورة","وضعيات رياضية"], description: "كوبيه رياضية أنيقة.", brochure: "broushors/mg_gt_leaflet_english_aw_ol_optimized_new.pdf" },
      { id: "mgzs_2025", name: "MG ZS 2025", price: 4444, condition: "new", category: "new", image: "images/mg-zs/mg-zs.avif", imageFolder: "images/mg-zs/", images: ["mg-zs.avif","mg-zs2.avif","mg-zs3.avif","mg-zs4.avif"], features: ["محرك 1.5 لتر","SUV مدمجة","شاشة 8 بوصة","أمان أساسي","مساحة تخزين كبيرة","اقتصادية"], description: "مثالية للاستخدام اليومي.", brochure: "broushors/mg_zs_brochure_eng_v1.3_new_1_.pdf" },
      { id: "mghs_2025", name: "MG HS 2025", price: 6999, condition: "new", category: "new", image: "images/mg-hs images/mg-hs.avif", imageFolder: "images/mg-hs images/", images: ["mg-hs.avif","mg-hs2.avif","mg-hs3.avif","mg-hs4.avif"], features: ["محرك 2.0 تيربو","AWD","شاشة 12.3","ملاحة متطور","مقاعد جلدية مدفأة","أمان شامل"], description: "راحة + أداء متوازن.", brochure: "broushors/mg_hs_brochure_en_r07_lowres.pdf" }
    ];

    // ===== Utils =====
    const $  = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const money = (v) => new Intl.NumberFormat(CONFIG.currencyLocale, { style: 'currency', currency: CONFIG.currency }).format(v);

    function carBadge(condition, category) {
      if (category === 'premium') return `<span class="badge" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; font-weight: 600;">Premium</span>`;
      if (category === 'electric') return `<span class="badge" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-weight: 600;">Electric</span>`;
      return `<span class="badge" style="background: linear-gradient(135deg, #374151 0%, #1f2937 100%); color: white; font-weight: 600;">New</span>`;
    }

    // ===== Render cars (unchanged logic + quick features) =====
    function renderCars(list) {
      const grid = $('#carsGrid');
      grid.innerHTML = "";
      if (!list.length) {
        grid.innerHTML = `<div class="col-12"><div class="alert alert-warning">لا توجد سيارات مطابقة لبحثك.</div></div>`;
        return;
      }
      list.forEach(car => {
        const col = document.createElement("div");
        col.className = "col-12 col-sm-6 col-lg-4";
        col.innerHTML = `
          <div class="card h-100 shadow-soft car-card" data-car-id="${car.id}" style="cursor: pointer;">
            <div class="img-wrap">
              <img src="${car.image}" alt="${car.name}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div style="display:none; justify-content:center; align-items:center; background:#f8f9fa; color:#6b7280; font-size:14px; text-align:center; padding:2rem;">
                <div>
                  <div style="font-size:2rem; margin-bottom:0.5rem;">🚗</div>
                  <div>صورة ${car.name}</div>
                </div>
              </div>
              <span class="price-badge">${money(car.price)}</span>
              <div class="position-absolute top-0 end-0 p-2">${carBadge(car.condition, car.category)}</div>
              <div class="position-absolute bottom-0 start-0 p-3">
                <small class="text-white bg-dark px-2 py-1 rounded" style="background: rgba(0,0,0,0.7) !important;">اضغط لمزيد من التفاصيل</small>
              </div>
            </div>
            <div class="card-body">
              <h5 class="card-title mb-1">${car.name}</h5>
              <ul class="car-quick-features">
                ${(car.features || []).slice(0,3).map(f => `<li>✓ ${f}</li>`).join('')}
              </ul>
              <p class="text-muted mb-3">عروض وشراء عبر مندوب المبيعات أحمد. السعر تقريبي ويتحدد النهائي عند التعاقد.</p>
              <div class="d-grid gap-2">
                <button class="btn btn-primary fw-semibold" data-car="${car.name}" data-bs-toggle="modal" data-bs-target="#purchaseModal">🚗 اشترِ الآن</button>
                <button class="btn btn-wa text-white fw-semibold" type="button" onclick="window.open(whatsappURL('🚘 استفسار عن ${car.name} — السعر: ${money(car.price)}'),'_blank','noopener')">📱 واتساب</button>
              </div>
            </div>
          </div>`;
        grid.appendChild(col);
      });
    }

    // ===== Card clicks & details modal =====
    function attachBuyButtons() {
      let isScrolling = false; 
      let touchStartY = 0;
      let touchStartX = 0; 
      let touchStartTime = 0;
      
      document.addEventListener('touchstart', (e) => { 
        touchStartY = e.touches[0].clientY; 
        touchStartX = e.touches[0].clientX;
        touchStartTime = Date.now(); 
        isScrolling = false; 
      }, { passive: true });
      
      document.addEventListener('touchmove', (e) => { 
        const dy = Math.abs(e.touches[0].clientY - touchStartY);
        const dx = Math.abs(e.touches[0].clientX - touchStartX);
        // Consider vertical movement of 15px or more as scrolling
        if (dy > 15 || dx > 15) {
          isScrolling = true;
        }
      }, { passive: true });
      
      $('#carsGrid').addEventListener('click', (e) => {
        // Prevent card opening if user was scrolling
        if (isScrolling) { 
          e.preventDefault(); 
          e.stopPropagation();
          return; 
        }
        
        // Prevent accidental taps by requiring longer touch duration
        const touchDuration = Date.now() - touchStartTime;
        if (touchDuration < 200) { 
          e.preventDefault();
          e.stopPropagation(); 
          return; 
        }
        
        const btn = e.target.closest('button[data-car]');
        const card = e.target.closest('.car-card[data-car-id]');
        
        if (btn) {
          e.stopPropagation();
          $('#carName').value = btn.getAttribute('data-car');
          startWizard(1); // reset wizard
        } else if (card) {
          e.stopPropagation();
          const carId = card.getAttribute('data-car-id');
          const car = CARS.find(c => c.id === carId);
          if (car) { showCarDetails(car); }
        }
      });
      
      // Reset scrolling flag after touch ends with a delay
      document.addEventListener('touchend', () => { 
        setTimeout(() => { isScrolling = false; }, 300); 
      }, { passive: true });
    }

    function showCarDetails(car) {
      $('#modalCarName').textContent = car.name;
      $('#modalCarPrice').textContent = money(car.price);
      $('#modalCarBadge').innerHTML = carBadge(car.condition, car.category);
      const featuresHtml = car.features ? car.features.map(f => `<li class="mb-2"><i class="text-success me-2">✓</i>${f}</li>`).join('') : '<li>مواصفات متميزة</li>';
      $('#carFeatures').innerHTML = `<ul class="list-unstyled">${featuresHtml}</ul>`;
      loadCarImages(car);
      $('#modalBuyBtn').onclick = () => {
        $('#carName').value = car.name;
        const detailsModal = bootstrap.Modal.getInstance($('#carDetailsModal'));
        detailsModal.hide();
        setTimeout(() => { startWizard(1); new bootstrap.Modal($('#purchaseModal')).show(); }, 300);
      };
      $('#modalWhatsAppBtn').onclick = () => {
        const message = `🚘 استفسار عن ${car.name} — السعر: ${money(car.price)}\nأنا مهتم بالتفاصيل المتاحة.`;
        window.open(whatsappURL(message), '_blank','noopener');
      };
      const brochureBtn = $('#modalBrochureBtn');
      if (car.brochure) {
        brochureBtn.style.display = 'block';
        brochureBtn.onclick = () => {
          const link = document.createElement('a');
          link.href = car.brochure; link.download = car.brochure.split('/').pop(); link.target = '_blank';
          document.body.appendChild(link); link.click(); document.body.removeChild(link);
        };
      } else brochureBtn.style.display = 'none';
      new bootstrap.Modal($('#carDetailsModal')).show();
    }
    
    function loadCarImages(car) {
      const carouselImages = $('#carouselImages');
      const carouselIndicators = $('#carouselIndicators');
      carouselImages.innerHTML = ''; carouselIndicators.innerHTML = '';
      const images = car.images || [car.image.split('/').pop()];
      const imageFolder = car.imageFolder || car.image.substring(0, car.image.lastIndexOf('/') + 1);
      images.forEach((img, index) => {
        const item = document.createElement('div');
        item.className = `carousel-item ${index === 0 ? 'active' : ''}`;
        item.innerHTML = `<img src="${imageFolder}${img}" class="d-block w-100" alt="${car.name}" style="height: 400px; object-fit: cover;" onerror="this.style.display='none'">`;
        carouselImages.appendChild(item);
        const indicator = document.createElement('button');
        indicator.type = 'button';
        indicator.setAttribute('data-bs-target', '#carImageCarousel');
        indicator.setAttribute('data-bs-slide-to', index.toString());
        indicator.className = index === 0 ? 'active' : '';
        indicator.setAttribute('aria-label', `Slide ${index + 1}`);
        if (index === 0) indicator.setAttribute('aria-current', 'true');
        carouselIndicators.appendChild(indicator);
      });
    }

    // ===== Search/Filter =====
    function setupSearchFilter() {
      const input = $('#searchInput');
      const select = $('#filterSelect');
      const apply = () => {
        const q = input.value.trim().toLowerCase();
        const f = select.value;
        const filtered = CARS.filter(c => {
          const matchQ = !q || c.name.toLowerCase().includes(q);
          const matchF = f === 'all' || c.category === f;
          return matchQ && matchF;
        });
        renderCars(filtered);
      };
      input.addEventListener('input', apply);
      select.addEventListener('change', apply);
    }

    // ===== Finance WIZARD =====
    let wizardStep = 1;
    function startWizard(step=1){
      wizardStep = step;
      updateWizardUI();
    }
    function updateWizardUI(){
      // panes
      $$('.wizard-pane').forEach(p => p.classList.remove('active'));
      const pane = $(`.wizard-pane[data-pane="${wizardStep}"]`);
      if (pane) pane.classList.add('active');

      // steps bar
      $$('.wizard-steps .step').forEach((el,i)=> el.classList.toggle('active', i < wizardStep));

      // buttons
      $('#wizardPrev').disabled = wizardStep === 1;
      $('#wizardNext').classList.toggle('d-none', wizardStep === 3);
      $('#wizardSubmit').classList.toggle('d-none', wizardStep !== 3);

      // show/hide finance-specific panes based on payment method
      const method = document.querySelector('input[name="paymentMethod"]:checked')?.value || 'Cash';
      if (wizardStep === 2 && method !== 'Finance') {
        // skip step 2 if cash
        wizardStep = 3;
        updateWizardUI();
      }
    }

    function initWizardControls(){
      $('#wizardPrev').addEventListener('click', () => { if (wizardStep > 1) { wizardStep--; updateWizardUI(); } });
      $('#wizardNext').addEventListener('click', () => {
        // validations per step
        if (wizardStep === 1) {
          const form = $('#purchaseForm');
          if (!$('#custName').value.trim() || !$('#custPhone').checkValidity()) {
            form.classList.add('was-validated'); return;
          }
          wizardStep = 2;
        } else if (wizardStep === 2) {
          const method = document.querySelector('input[name="paymentMethod"]:checked').value;
          if (method === 'Finance') {
            if (!$('#bankSelect').value || !$('#loanYears').value || !$('#apr').value) {
              // simple hint
              alert('فضلاً اختر شركة التمويل والسنوات ليتم الحساب.');
              return;
            }
          }
          wizardStep = 3;
        }
        updateWizardUI();
      });

      // when user toggles payment method, keep wizard valid
      document.querySelectorAll('input[name="paymentMethod"]').forEach(r => r.addEventListener('change', () => {
        // if moved to cash while on step 2, jump to 3
        if (wizardStep === 2 && r.value === 'Cash' && r.checked) { wizardStep = 3; updateWizardUI(); }
        if (wizardStep === 3 && r.value === 'Finance' && r.checked) { wizardStep = 2; updateWizardUI(); }
      }));
    }

    // ===== Finance compute (same logic) =====
    function setupFinanceCalculator() {
      const bankSelect = $('#bankSelect');
      const yearsSelect = $('#loanYears');
      const apr = $('#apr');
      const down = $('#downPayment');
      const emiOut = $('#emi');
      const budget = $('#budget');
      const totalPayable = $('#totalPayable');
      const totalInterest = $('#totalInterest');
      const budgetStatus = $('#budgetStatus');

      function populateOptions() {
        FINANCING_COMPANIES.forEach(company => {
          const opt = document.createElement("option");
          opt.value = `${company.name} (${company.rate}%)`;
          opt.textContent = `${company.name} - ${company.rate}%`;
          opt.setAttribute('data-rate', company.rate);
          bankSelect.appendChild(opt);
        });
        for (let y=1; y<=4; y++) {
          const opt = document.createElement("option");
          opt.value = String(y); opt.textContent = `${y} سنة`;
          yearsSelect.appendChild(opt);
        }
      }

      function calc(){
        const carName = $('#carName').value;
        const car = CARS.find(c=>c.name===carName);
        if(!car) { 
          emiOut.value=''; totalPayable.value=''; totalInterest.value=''; budgetStatus.textContent='—'; 
          return; 
        }
        const carPrice = car.price;
        const downPayment = parseFloat(down.value) || 0;
        const principal = Math.max(0, carPrice - downPayment);
        const years = parseInt(yearsSelect.value) || 0;
        const selectedOption = bankSelect.options[bankSelect.selectedIndex];
        const annualRate = selectedOption ? parseFloat(selectedOption.getAttribute('data-rate')) : 0;
        apr.value = annualRate || '';
        if (!principal || !years || !annualRate || !bankSelect.value) { 
          emiOut.value=''; totalPayable.value=''; totalInterest.value=''; budgetStatus.textContent='—'; 
          return; 
        }
        const monthlyRate = annualRate / 100 / 12;
        const totalMonths = years * 12;
        const numerator = principal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths);
        const denominator = Math.pow(1 + monthlyRate, totalMonths) - 1;
        const monthlyEMI = numerator / denominator;
        const totalAmount = monthlyEMI * totalMonths;
        const interestOnly = totalAmount - principal;

        emiOut.value = money(Math.round(monthlyEMI));
        totalPayable.value = money(Math.round(totalAmount + (downPayment||0)));
        totalInterest.value = money(Math.round(interestOnly));

        const budgetAmount = parseFloat(budget.value) || 0;
        if (budgetAmount > 0) {
          const diff = budgetAmount - monthlyEMI;
          if (diff >= 0) {
            budgetStatus.textContent = `ضمن الميزانية ✅ (توفّر ${money(Math.round(diff))} بالشهر)`;
            budgetStatus.style.background = '#e8fff2';
            budgetStatus.style.color = '#065f46';
          } else {
            budgetStatus.textContent = `يتجاوز الميزانية ❌ بمقدار ${money(Math.round(-diff))} بالشهر`;
            budgetStatus.style.background = '#fff1f2';
            budgetStatus.style.color = '#9f1239';
          }
        } else { 
          budgetStatus.textContent = '—'; budgetStatus.style.color = ''; budgetStatus.style.background = ''; 
        }
      }

      populateOptions();
      [bankSelect, yearsSelect, down, budget].forEach(el=> el.addEventListener('change', calc));
      [down, budget].forEach(el=> el.addEventListener('input', calc));
      // expose for wizard steps to recalc when entering step 2/3
      window._recalcFinance = calc;
    }

    // ===== WhatsApp URL =====
    function whatsappURL(message) {
      const base = `https://wa.me/${CONFIG.whatsappNumberE164}`;
      return `${base}?text=${encodeURIComponent(message)}`;
    }

    // ===== Form submit (build structured message) =====
    function setupForm() {
      const form = $('#purchaseForm');
      const toastEl = $('#toast');
      const toast = new bootstrap.Toast(toastEl, { delay: 4000 });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        e.stopPropagation();

        if (!form.checkValidity()) {
          form.classList.add('was-validated');
          return;
        }

        const car = $('#carName').value.trim();
        const name = $('#custName').value.trim();
        const phone = $('#custPhone').value.trim();
        const method = document.querySelector('input[name="paymentMethod"]:checked').value;
        const financingCompany = $('#bankSelect').value;
        const years = $('#loanYears').value;

        let lines = [
          "🚗 *طلب سيارة إم جي جديدة* — من موقع أحمد (مندوب مبيعات)",
          `👤 الاسم: ${name}`,
          `📞 الرقم: ${phone}`,
          `🚙 السيارة: ${car}`,
          `💰 طريقة الدفع: ${method === 'Finance' ? 'تمويل' : 'كاش'}`
        ];
        if (method === 'Finance') {
          const aprVal = $('#apr').value;
          const downVal = $('#downPayment').value;
          const budgetVal = $('#budget').value;
          const totalVal = $('#totalPayable').value;
          const interestVal = $('#totalInterest').value;
          const emiVal = $('#emi').value;

          lines.push(`🏦 شركة التمويل: ${financingCompany}`);
          lines.push(`📆 عدد السنوات: ${years}`);
          if(aprVal) lines.push(`📊 نسبة الفائدة: ${aprVal}%`);
          if(downVal) lines.push(`💵 الدفعة الأولى: ${downVal} د.ك`);
          if(budgetVal) lines.push(`🎯 القسط المرغوب: ${budgetVal} د.ك`);
          if(emiVal) lines.push(`💸 القسط التقديري: ${emiVal}`);
          if(totalVal) lines.push(`🧾 الإجمالي التقديري: ${totalVal}`);
          if(interestVal) lines.push(`📈 إجمالي الفوائد: ${interestVal}`);
        }
        lines.push(`ℹ️ *تنويه:* هذا موقع شخصي لمندوب مبيعات — لست الوكيل الرسمي.`);
        const message = lines.join('\n');

        try { await navigator.clipboard.writeText(message); } catch {}

        window.open(whatsappURL(message), '_blank', 'noopener');

        toast.show();
        form.reset();
        form.classList.remove('was-validated');
        document.querySelectorAll('input[name="paymentMethod"]').forEach(r => r.checked = r.id === 'payCash');
        startWizard(1);
      });
    }

    // ===== Wire CTAs / Theming / Mobile niceties =====
    function wireCTAs() {
      const msg = "مرحباً أحمد! مهتم بسيارات إم جي في الكويت. هذا استفسار من الموقع الشخصي.";
      const wa = `https://wa.me/${CONFIG.whatsappNumberE164}?text=${encodeURIComponent(msg)}`;
      ['ctaWhatsAppTop','ctaWhatsAppHero','ctaWhatsAppContact','fabWhatsApp','bottomWA'].forEach(id=>{
        const el = document.getElementById(id); if(el) el.href = wa;
      });
      $('#ctaCall').href = `tel:${CONFIG.callNumber.replace(/\\s+/g,'')}`;
      $('#ctaEmail').href = `mailto:${CONFIG.email}`;
      $('#salesName').textContent = 'Ahmed — مندوب مبيعات MG';
      $('#contactPhoto').src = CONFIG.contactPhoto || $('#contactPhoto').src;
      $('#mapEmbed').src = CONFIG.mapEmbedSrc;
      $('#year').textContent = new Date().getFullYear();
    }

    function startThemeRotation(){
      try{
        const metaTheme = document.querySelector('meta[name="theme-color"]');
        let idx = 0;
        const apply = (t)=>{ document.documentElement.style.setProperty('--wa', t.wa); document.documentElement.style.setProperty('--primary', t.primary||'#3b82f6'); document.documentElement.style.setProperty('--dark', t.dark||'#0f172a'); if(metaTheme) metaTheme.setAttribute('content', t.wa); };
        const list = CONFIG.themes || []; if(!list.length) return;
        apply(list[0]); setInterval(()=>{ idx = (idx+1)%list.length; apply(list[idx]); }, (CONFIG.themeRotateSeconds||12)*1000);
      }catch(e){ console.warn('Theme rotation failed', e); }
    }

    function runSelfTests(){
      try {
        const P = 10000, annualRate = 0.05, years = 5; const monthlyRate = annualRate/12; const n=years*12;
        const emi = P*monthlyRate*Math.pow(1+monthlyRate,n)/(Math.pow(1+monthlyRate,n)-1);
        console.assert(Math.abs(Math.round(emi)-189)<=5, `EMI ~189, got ${Math.round(emi)}`);
      } catch (err) { console.error('Self-tests failed', err); }
    }

    function setupMobileOptimizations() {
      // Optimize touch events
      document.addEventListener('touchstart', function() {}, { passive: true });
      
      // Enhance form inputs for mobile
      const inputs = document.querySelectorAll('input, select, textarea');
      inputs.forEach(input => { 
        // Prevent zoom on iOS
        input.style.fontSize = '16px';
        // Smooth scroll to input when focused
        input.addEventListener('focus', function(){ 
          setTimeout(() => { this.scrollIntoView({ behavior:'smooth', block:'center' }); }, 300); 
        }); 
      });
      
      // Fix modal issues on mobile
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.addEventListener('shown.bs.modal', function(){ document.body.style.position='fixed'; document.body.style.width='100%'; });
        modal.addEventListener('hidden.bs.modal', function(){ document.body.style.position=''; document.body.style.width=''; });
      });
      
      // Only apply these optimizations on mobile devices
      if (window.innerWidth <= 768) {
        // Enhance touch targets for better accessibility
        document.querySelectorAll('a, button, .nav-link, .btn').forEach(el => {
          if (el.offsetHeight < 44) {
            el.style.minHeight = '44px';
          }
          if (el.offsetWidth < 44) {
            el.style.minWidth = '44px';
          }
          // Add active state for better touch feedback
          el.addEventListener('touchstart', function() {
            this.classList.add('touch-active');
          }, {passive: true});
          el.addEventListener('touchend', function() {
            this.classList.remove('touch-active');
          }, {passive: true});
        });
        
        // Improve scrolling performance
        document.body.style.cssText += 'overscroll-behavior: contain; -webkit-overflow-scrolling: touch;';
        
        // Optimize bottom navigation for iOS safe areas
        const bottomNav = document.querySelector('.bottom-nav');
        if (bottomNav) {
          bottomNav.style.paddingBottom = 'calc(env(safe-area-inset-bottom, 0px) + 10px)';
        }
        
        // Add pull-to-refresh functionality
        let touchStartY = 0;
        document.addEventListener('touchstart', function(e) {
          touchStartY = e.touches[0].clientY;
        }, {passive: true});
        
        document.addEventListener('touchend', function(e) {
          const touchEndY = e.changedTouches[0].clientY;
          if (window.scrollY === 0 && touchEndY > touchStartY + 100) {
            location.reload();
          }
        }, {passive: true});
      }
    }

    // Initialize lazy loading for images
    function initLazyLoading() {
      const lazyImages = document.querySelectorAll('.lazy-image');
      
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.src = img.dataset.src;
              img.onload = () => {
                img.style.display = 'block';
                img.previousElementSibling.style.display = 'none';
              };
              imageObserver.unobserve(img);
            }
          });
        });
        
        lazyImages.forEach(img => {
          imageObserver.observe(img);
        });
      } else {
        // Fallback for browsers without IntersectionObserver
        lazyImages.forEach(img => {
          img.src = img.dataset.src;
          img.onload = () => {
            img.style.display = 'block';
            img.previousElementSibling.style.display = 'none';
          };
        });
      }
    }
    
    // ===== INIT =====
    renderCars(CARS);
    attachBuyButtons();
    setupSearchFilter();

    // Wizard & finance
    startWizard(1);
    initWizardControls();
    setupFinanceCalculator();

    setupForm();    
    wireCTAs();
    startThemeRotation();
    setupMobileOptimizations();
    initLazyLoading();
    runSelfTests();
    
    // Initialize AOS animations
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true,
      mirror: false,
      disable: window.innerWidth < 768 ? 'phone' : false
    });
  </script>
</body>
</html>
